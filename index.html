<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElderGuard Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .alert-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="notification" class="fixed top-4 right-4 z-50 transform translate-x-full transition-transform duration-300 bg-emerald-600 text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3">
        <i data-lucide="check-circle"></i>
        <span id="notification-text">Action completed!</span>
    </div>

    <div class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="max-w-6xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-800 flex items-center gap-2">
                    <i data-lucide="activity" class="text-blue-600"></i> ElderGuard Dashboard
                </h1>
                <p class="text-slate-500">Real-time health & safety monitoring</p>
            </div>
            <div class="flex items-center gap-4 bg-white p-4 rounded-2xl shadow-sm border border-slate-100 w-full md:w-auto">
                <div class="p-2 bg-slate-100 rounded-full">
                    <i data-lucide="user" class="text-slate-500"></i>
                </div>
                <div>
                    <p class="text-sm font-bold">John Doe (Patient)</p>
                    <p class="text-xs text-slate-400">ID: WATCH-789 | Emergency: +1 234 567</p>
                </div>
            </div>
        </header>

        <main class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Health Metrics -->
            <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Heart Rate Card -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-red-500">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-red-50 rounded-xl text-red-600">
                            <i data-lucide="heart"></i>
                        </div>
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Heart Rate</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="heartRate" class="text-5xl font-black text-slate-800">--</span>
                        <span class="text-slate-400 font-bold uppercase text-xs">bpm</span>
                    </div>
                    <p class="mt-3 text-xs text-emerald-500 font-bold flex items-center gap-1">
                        <i data-lucide="trending-up" class="w-3 h-3"></i> Stable
                    </p>
                </div>

                <!-- Oxygen Card -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-blue-500">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-blue-50 rounded-xl text-blue-600">
                            <i data-lucide="wind"></i>
                        </div>
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Blood Oxygen</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="spo2" class="text-5xl font-black text-slate-800">--</span>
                        <span class="text-slate-400 font-bold uppercase text-xs">% SpO2</span>
                    </div>
                    <p class="mt-3 text-xs text-emerald-500 font-bold flex items-center gap-1">
                        <i data-lucide="check" class="w-3 h-3"></i> Normal
                    </p>
                </div>

                <!-- Activity Banner -->
                <div class="bg-white p-6 rounded-3xl shadow-sm col-span-full flex flex-col sm:flex-row items-center justify-between gap-4 border border-slate-100">
                    <div class="flex items-center gap-4">
                        <div id="activityIcon" class="p-4 bg-slate-50 rounded-2xl text-slate-600">
                            <i data-lucide="zap"></i>
                        </div>
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">User Status</p>
                            <p id="activity" class="text-2xl font-black text-slate-800 capitalize">Loading...</p>
                        </div>
                    </div>
                    <div class="text-center sm:text-right border-t sm:border-t-0 sm:border-l border-slate-100 pt-4 sm:pt-0 sm:pl-8">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Last Updated</p>
                        <p id="lastSeen" class="text-sm font-semibold text-slate-600">Waiting for sync...</p>
                    </div>
                </div>
            </div>

            <!-- Alerts Panel -->
            <div class="bg-slate-900 text-white p-6 rounded-3xl shadow-2xl flex flex-col">
                <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                    <i data-lucide="bell" class="text-yellow-400"></i> Emergency Feed
                </h2>
                <div id="alertsContainer" class="space-y-4 flex-1 overflow-y-auto max-h-[400px] pr-2">
                    <!-- Alerts will be injected here -->
                    <div class="text-slate-500 text-sm text-center py-10">No recent alerts recorded.</div>
                </div>
            </div>

            <!-- Medication Management -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3 text-slate-800">
                    <i data-lucide="clock" class="text-indigo-600 p-2 bg-indigo-50 rounded-lg"></i> Medicine Reminder
                </h2>
                <div class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Drug Name</label>
                        <input type="text" id="medName" placeholder="e.g. Aspirin 10mg" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Time Slot</label>
                        <input type="time" id="medTime" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition">
                    </div>
                    <button onclick="triggerMedication()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-2xl font-bold shadow-lg shadow-indigo-100 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-4 h-4"></i> Send to Watch
                    </button>
                </div>
            </div>

            <!-- Configuration -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 md:col-span-2">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3 text-slate-800">
                    <i data-lucide="settings" class="text-slate-400 p-2 bg-slate-50 rounded-lg"></i> Safety Thresholds
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Min Heart Rate</label>
                        <input type="number" value="50" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Max Heart Rate</label>
                        <input type="number" value="120" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Min Oxygen %</label>
                        <input type="number" value="92" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none">
                    </div>
                    <div class="sm:col-span-3">
                        <button onclick="showToast('Settings updated (Simulation)')" class="bg-slate-800 hover:bg-black text-white px-8 py-3 rounded-xl text-sm font-bold transition">Update Config</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDK Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD4uzq-K0ylVdzLGI2gD4iy9wbialmJZ0c",
            authDomain: "watch-1ff3d.firebaseapp.com",
            databaseURL: "https://watch-1ff3d-default-rtdb.firebaseio.com",
            projectId: "watch-1ff3d",
            storageBucket: "watch-1ff3d.firebasestorage.app",
            messagingSenderId: "1094522997554",
            appId: "1:1094522997554:web:8833eb4bba862adb94a52b",
            measurementId: "G-4P41ZBKFSH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // UI Element References
        const elements = {
            heartRate: document.getElementById('heartRate'),
            spo2: document.getElementById('spo2'),
            activity: document.getElementById('activity'),
            lastSeen: document.getElementById('lastSeen'),
            alertsContainer: document.getElementById('alertsContainer')
        };

        // Real-time Health Listener
        onValue(ref(db, 'live_data'), (snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                elements.heartRate.innerText = data.heartRate || '--';
                elements.spo2.innerText = data.spo2 || '--';
                elements.activity.innerText = data.activity || 'Idle';
                elements.lastSeen.innerText = data.lastSeen || 'Syncing...';
            }
        });

        // Alerts Listener
        onValue(ref(db, 'alerts'), (snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                const alertList = Object.values(data).reverse().slice(0, 5);
                
                elements.alertsContainer.innerHTML = alertList.map(alert => `
                    <div class="bg-slate-800 p-4 rounded-2xl border-l-4 border-red-500 alert-pulse shadow-lg">
                        <p class="font-black text-red-500 text-xs uppercase mb-1 tracking-tighter">Emergency Triggered</p>
                        <p class="font-bold text-white">${alert.type}</p>
                        <p class="text-[10px] text-slate-500 mt-2">${alert.timestamp}</p>
                    </div>
                `).join('');
            }
        });

        // Global functions exposed for the buttons
        window.triggerMedication = async () => {
            const medName = document.getElementById('medName').value;
            const medTime = document.getElementById('medTime').value;

            if (!medName || !medTime) {
                alert("Please enter medicine details.");
                return;
            }

            try {
                // Set the flag for the watch to ring
                await set(ref(db, 'med_trigger'), true);
                // Log the history
                await push(ref(db, 'med_history'), {
                    name: medName,
                    time: medTime,
                    triggeredAt: new Date().toLocaleTimeString()
                });
                showToast(`Sent reminder for ${medName}`);
            } catch (error) {
                console.error("Firebase Error:", error);
            }
        };

        window.showToast = (msg) => {
            const toast = document.getElementById('notification');
            document.getElementById('notification-text').innerText = msg;
            toast.classList.remove('translate-x-full');
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        };

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
